# 统一认证

## 前言

在小程序越来越多后，相应的管理系统也再增加，想着总不能每一个管理系统都带一个用户认证吧，那继续扩展不得继续复制粘贴代码，继续增加数据库。所以思索再三后，决定把现有的认证系统独立出来，实现统一认证所有的系统。

统一认证的话，主要难点在于本身的管理系统使用的MVC架构，已经投入使用。现在突然把已经构建好的MVC再改成请求web API的工作量有一丢丢大，所以是打算做成SSO，统一认证服务登录后，其它系统也就登录，主要是为了保护MVC客户端，使用的传统认证（Cookie＋Session）。

虽然很想直接用identity server 4，但最后还是选择了自己搞一个，反正也不是很难，显然也做出来很简陋（划掉，怎么能承认自己做的辣鸡呢）

## 开始

首先我们先来了解一下OAuth 2。



在原本的解决方案里建立一个asp.net core mvc项目，配置使用cookie认证和jwt认证同时使用。

新建一个mvc控制器，就叫Identity吧，然后写一个Login方法，返回登录页面，再写一个post的Login方法用来接收用户登录的post请求，验证用户凭据成功后，用户登录统一认证服务器，将cookie写到浏览器中存储，将用户的claim返回给客户端，客户端使用claim登录用户



### OAuth原理

OAuth 2.0是一个